# Next.js Backend Application Using database.build, Supabase, and Daytona

A backend application for a blog platform built with Next.js, utilizing Supabase as the PostgreSQL database service. The database schema, which includes structured tables for Users, Blog Posts, and Comments, was designed effortlessly using the AI-powered tool [database.build](https://database.build/).

This application is containerized to be easily run using [Daytona](https://www.daytona.io/). It serves as a hands-on backend app where users can perform CRUD operations on the database through API endpoints.

## Features

- Create, retrieve, update, and delete users, blog posts, and comments.
- PostgreSQL database schema for efficient data management.
- Simple API endpoints to interact with the database.
- Dev Container for a quick development environment setup using Daytona.

## Technologies Used

- **Backend:**  [Next.js](https://nextjs.org/) framework for building server-rendered and API-driven applications.
- **Database:**  [Supabase](https://supabase.com/) - a PostgreSQL-based service offeringa a scalable database solution.
- **Schema Design:** [database.build](https://database.build/) - an AI tool that generates well-organized database schemas with ease.

## Setting up the Database in Supabase


1. Go to [database.build](https://database.build/) and enter a prompt to design your own blog applicaion database, such as:

    ```
    Design a database for a blog website with the following tables - Users, Blog Posts, Comments. Ensure appropriate relationships between these entities for efficient data management.
    ```

2. For this application, we used this database schema generated by [database.build](https://database.build/) specifically for a blog application.

    ```sql
    create table users (
    id bigint primary key generated always as identity,
    username text not null unique,
    email text not null unique,
    password text not null,
    created_at timestamptz default now()
    );

    create table blog_posts (
    id bigint primary key generated always as identity,
    user_id bigint not null,
    title text not null,
    content text not null,
    created_at timestamptz default now(),
    foreign key (user_id) references users (id) on delete cascade
    );

    create table comments (
    id bigint primary key generated always as identity,
    blog_post_id bigint not null,
    user_id bigint not null,
    content text not null,
    created_at timestamptz default now(),
    foreign key (blog_post_id) references blog_posts (id) on delete cascade,
    foreign key (user_id) references users (id) on delete cascade
    );
    ```

    ![database-build-demo-design](/docs/assets/datbase-build-design.png)

3. Now, set up your Supabase project by following this [documentation](https://supabase.com/docs/guides/database/overview). In the **Supabase dashboard**, go to the **Table Editor** and create the database tables as per the design generated from **database.build**. 

4. After setting up the tables, get the `Project URL` and `Project API Key` from **Project Settings** > **API** in your **Supabase project dashboard**.

## Setting Up the Workspace with Daytona

### Prerequisites 

- Daytona pre-installed.
- Running Docker Engine.
- Running Daytona server using: `daytona serve` command.

### Steps to Set Up Workspace

**1. Create and open the workspace in Daytona:**

Use the following command to initialize your Daytona workspace while passing the **SUPABASE_URL** and **SUPABASE_API_KEY** as a **remote environment variable**:
    
```bash 
daytona create https://github.com/daytonaio-experiments/starter-nextjs-supabase --env "SUPABASE_URL=<your_supabase_url>" --env "SUPABASE_API_KEY=<your_supabase_api_key>"
```

**2. Run the application on Port - 3000 (default):** After the workspace is created, start your development server:

```bash
npm run dev
```

## REST API Endpoints for this Application

You can use these endpoints to interact with the database via Postman or similar tools.

### User Endpoints:

- **POST /api/create-user** - Add a user

    **Body:** `{ "username": "string", "email": "string", "password": "string", "created_at": "timestamp" }`

- **DELETE /api/delete-user** - Delete a user

    **Body:** `{ "id": "int" }`

- **GET /api/get-users** - Retrieve all users

### Blog Endpoints:

- **POST /api/create-blog** - Add a blog post

    **Body:** `{ "user_id": "int", "title": "string", "content": "string", "created_at": "timestamp" }`

- **PATCH /api/update-blog** - Update a blog post

    **Body:** `{ "id": "int", "title": "string", "content": "string" }`

- **DELETE /api/delete-blog** - Delete a blog post

    **Body:** `{ "id": "int" }`

- **GET /api/get-blogs** - Retrieve all blog posts

### Comment Endpoints:

- **POST /api/add-comment** - Add a comment

    **Body:** `{ "blog_post_id": "int", "user_id": "int", "content": "string", "created_at": "timestamp" }`

- **POST /api/get-comment** - Retrieve comments for a blog post

    **Body:** `{ "blog_post_id": "int" }`

- **DELETE /api/delete-comment** - Delete a comment

    **Body:** `{ "id": "int" }`

## Dev Container Configuration

This project includes a pre-configured development container setup using `devcontainer.json` to provide a consistent and isolated development environment for working with Next.js and Supabase.

```json
{
    "name": "Next.js Backend with Supabase",
    "image": "ubuntu:22.04",
    "features": {
        "ghcr.io/devcontainers/features/common-utils:2.5.2": {
            "username": "daytona",
            "userUid": 1000,
            "userGid": 1000,
            "configureZshAsDefaultShell": true
        },
        "ghcr.io/devcontainers/features/node:1": {
            "nodeGypDependencies": true,
            "version": "lts",
            "nvmVersion": "0.40.0"
        },
        "ghcr.io/devcontainers/features/git:1": {}
    },
    "overrideFeatureInstallOrder": [
        "ghcr.io/devcontainers/features/common-utils",
        "ghcr.io/devcontainers/features/git",
        "ghcr.io/devcontainers/features/node"
    ],
    "portsAttributes": {
        "3000": {
            "label": "Next.js App",
            "onAutoForward": "notify"
        },
        "9229": {
            "label": "Node.js Debugger",
            "onAutoForward": "ignore"
        }
    },
    "customizations": {
        "vscode": {
            "extensions": [
                "dbaeumer.vscode-eslint",
                "esbenp.prettier-vscode",
                "ms-vscode.vscode-typescript-next",
                "mhutchie.git-graph"
            ]
        }
    },
    "workspaceFolder": "/workspaces/starter-nextjs-supabase",
    "onCreateCommand": "npm install",
    "remoteUser": "daytona"
}
```


### This configuration includes:

- **name:** Sets the environment name to "Next.js Backend with Supabase".
- **image:** The base image is `ubuntu:22.04`, providing a Linux environment.
- **features:**
    - **common-utils:** Adds common utilities for the user **daytona**.
    - **node:** Installs the latest stable version of Node.js with nvm, setting up node-gyp dependencies.
    - **git:** Installs Git.
- **overrideFeatureInstallOrder:** Specifies the order in which features are installed for efficient setup.
- **portsAttributes:**
    - Configures port `3000` for the Next.js app with automatic notifications for port forwarding.
    - Port `9229` is reserved for the Node.js debugger.
- **customizations:** Adds essential VSCode extensions for ESLint, Prettier, TypeScript, and Git visualization.
- **workspaceFolder:** Sets the workspace directory to `/workspaces/starter-nextjs-supabase`.
- **onCreateCommand:** Automatically runs `npm install` to set up project dependencies upon container creation.
- **remoteUser:** Specifies `daytona` as the user for the development environment.

## Why Daytona?

Daytona is a radically simple open source development environment manager.

Setting up development environments has become increasingly challenging over time, especially when aiming to set up remotely, where the complexity increases by an order of magnitude. The process is so complex that we've compiled a comprehensive guide detailing all the necessary steps to set one up—spanning 5,000 words, 7 steps, and requiring anywhere from 15 to 45 minutes.

This complexity is unnecessary.

With Daytona, you need only to execute a single command: daytona create --code.

Daytona automates the entire process; provisioning the instance, interpreting and applying the configuration, setting up prebuilds, establishing a secure VPN connection, securely connecting your local or a Web IDE, and assigning a fully qualified domain name to the development environment for easy sharing and collaboration.

As a developer, you can immediately start focusing on what matters most—your code.

## Quick Start
### Mac / Linux
```bash
(curl -sf -L https://download.daytona.io/daytona/install.sh | sudo bash) && daytona server -y && daytona
```
### Windows
<details>
<summary>Windows PowerShell</summary>
This command downloads and installs Daytona and runs the Daytona Server:

```pwsh
$architecture = if ($env:PROCESSOR_ARCHITECTURE -eq "AMD64") { "amd64" } else { "arm64" }
md -Force "$Env:APPDATA\bin\daytona"; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.SecurityProtocolType]'Tls,Tls11,Tls12';
Invoke-WebRequest -URI "https://download.daytona.io/daytona/latest/daytona-windows-$architecture.exe" -OutFile "$Env:APPDATA\bin\daytona\daytona.exe";
$env:Path += ";" + $Env:APPDATA + "\bin\daytona"; [Environment]::SetEnvironmentVariable("Path", $env:Path, [System.EnvironmentVariableTarget]::User);
daytona serve;
```

</details>

### Create your first dev environment by opening a new terminal, and running:

```bash
daytona create --code
```
## Getting Started
### Requirements
Before starting the installation script, please go over all the necessary requirements:
- __Hardware Resources__: Depending on the project requirements, ensure your machine has sufficient resources. Minimum hardware specification is 1cpu, 2GB of RAM and 10GB of disk space.
- __Docker__: Ensure [Docker](https://www.docker.com/products/docker-desktop/) is installed and running.

### Initializing Daytona
To initialize Daytona, follow these steps:

__1. Start the Daytona Server:__
This initiates the Daytona Server in daemon mode. Use the command:
```bash
daytona server
```
__2. Add Your Git Provider of Choice:__
Daytona supports GitHub, GitLab, Bitbucket, Bitbucket Server, Gitea, Gitness and Azure DevOps. To add them to your profile, use the command:
```bash
daytona git-providers add

```
Follow the steps provided.

__3. Add Your Provider Target:__
This step is for choosing where to deploy Development Environments. By default, Daytona includes a Docker provider to spin up environments on your local machine. For remote development environments, use the command:
```bash
daytona target set
```
Following the steps this command adds SSH machines to your targets.

__4. Choose Your Default IDE:__
The default setting for Daytona is VS Code locally. If you prefer, you can switch to VS Code - Browser or any IDE from the JetBrains portfolio using the command:
```bash
daytona ide
```
Now that you have installed and initialized Daytona, you can proceed to setting up your development environments and start coding instantly.


### Creating Dev Environments
Creating development environments with Daytona is a straightforward process, accomplished with just one command:
```bash
daytona create --code
```

You can skip the `--code` flag if you don't wish to open the IDE immediately after creating the environment.

Upon executing this command, you will be prompted with two questions:
1. Choose the provider to decide where to create a dev environment.
2. Select or type the Git repository you wish to use to create a dev environment.

After making your selections, press enter, and Daytona will handle the rest. All that remains for you to do is to execute the following command to open your default IDE:
```bash
daytona code
```

This command opens your development environment in your preferred IDE, allowing you to start coding instantly.

### Stopping the Daytona Server:
```bash
daytona server stop
```

### Restarting the Daytona Server:
```bash
daytona server restart
```


## License

This repository contains Daytona, covered under the [Apache License 2.0](https://github.com/daytonaio/daytona/blob/main/LICENSE), except where noted (any Daytona logos or trademarks are not covered under the Apache License, and should be explicitly noted by a LICENSE file.)

Daytona is a product produced from this open source software, exclusively by Daytona Platforms, Inc. It is distributed under our commercial terms.

Others are allowed to make their own distribution of the software, but they cannot use any of the Daytona trademarks, cloud services, etc.

We explicitly grant permission for you to make a build that includes our trademarks while developing Daytona itself. You may not publish or share the build, and you may not use that build to run Daytona for any other purpose.
## Code of Conduct

This project has adapted the Code of Conduct from the [Contributor Covenant](https://www.contributor-covenant.org/). For more information see the [Code of Conduct](https://github.com/daytonaio/daytona/blob/main/CODE_OF_CONDUCT.md) or contact codeofconduct@daytona.io. with any additional questions or comments.
## Questions

For more information on how to use and develop Daytona, talk to us on [Slack](https://go.daytona.io/slack).
